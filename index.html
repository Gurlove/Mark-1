<!DOCTYPE HTML>
<html>
    <head>
        <!-- Webix CSS file-->  
        <link rel="stylesheet" href="codebase/webix.css" type="text/css">
        <!-- QUnit CSS file-->  
        <link rel="stylesheet" href="qunit/qunit-2.0.1.css">
        <!-- Webix JS file-->    
        <script src="codebase/webix.js" type="text/javascript"></script>  
        <!-- QUnit JS file-->    
        <script src="qunit/qunit-2.0.1.js"></script>
    </head>
    <body>
        <!-- QUnit divs to show test results--> 
        <div id="qunit"></div>
        <div id="qunit-fixture"></div>
        <!--link to download salesrecords.csv-->
        <a href="data/salesreport.csv" download id="download" hidden></a>
        <!--<div id="box" style="width:1200px;height:800px;"></div>-->
        <script type="text/javascript" charset="utf-8">
        // main UI (CRUD)
        webix.csv.delimiter.cols = ",";
        webix.ui
        ({
            rows: 
            [

                { type:"header", template:"Sales Records" },
 
                {   
                    view:"toolbar", id:"crud", elements:
                    [
                        { view:"button", value:"Add", width: 70},
                        { view:"button", value:"Edit", width: 70},
                    ]
                },

                {
                    view:"datatable", fillspace:1, columns:
                    [
                        { id: "data1", header:"Item Name", width:180 },
                        { id: "data2", header:"Sales", width:100 },
                        { id: "data3", header:"Sale Price ($)", width:140 },
                        { id: "data4", header:"Stock Price ($)", width:140 }
                    ],
                    // loads data from csv file
                    select:true,
                    datatype:"csv",
                    url:'data/salesrecords.csv'
                },

                { type:"header", template:"Reports" },

                {   
                    view:"toolbar", id:"Reports", elements:
                    [
                        { view:"button", value:"View Sales Report", width: 160, click:"toggle_sales_report"},
                        { view:"button", value:"View Stocktake Report", width: 160},
                    ]
                }
            ]
        }); 

        // sales report window 
        salesreport = new webix.ui
        ({
            view:"window", move:true,
            left:300, top:400,
            head:
            {
                view:"toolbar", id:"salesreport", elements:
                [
                    { type:"header", template:"Monthly Sales Report"},
                    { view:"button", value:"Export CSV", align: 'left', width: 160, click:"export_csv"},
                    { view:"button", value:"Close", align: 'right', width: 160, click:"toggle_sales_report"}
                ]
            },

            body:
            {
                view:"datatable", id:"reporttable",
                columns:
                [
                    { id: "data1", header:"Item Name", width:180 },
                    { id: "data2", header:"Sales", width:100 },
                    { id: "data3", header:"Profit ($)", width:140 },
                    { id: "data4", header:"ROI (%)", width:140 }
                ],
                autoheight:true,
                autowidth:true,
                // loads data from csv file
                datatype:"csv",
                url:'data/salesreport.csv'
            }
        })

        // chuck our functions here for organisational purposes

        // toggle sales report window
        function toggle_sales_report()
        {   
            if (salesreport.isVisible())
            {
                salesreport.hide();
            }
            else
            {
                 salesreport.show();
            }
        }

        // export data to csv
        function export_csv()
        {
            document.getElementById('download').click();
        }

        //testing toggle_sales_report
        
        QUnit.test("toggle report", function(assert)
        {
            toggle_sales_report();
            assert.equal(salesreport.isVisible(), true, "Report should be visible.");
        });

        </script>
    </body>
</html>